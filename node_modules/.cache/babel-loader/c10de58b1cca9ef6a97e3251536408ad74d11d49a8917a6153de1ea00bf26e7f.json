{"ast":null,"code":"// Email integration service\n// Supports Gmail API, Outlook Graph API, and generic IMAP\n\nclass EmailService {\n  constructor(settings) {\n    this.settings = settings;\n    this.isAuthorized = false;\n  }\n  async authorize() {\n    if (this.settings.provider === 'gmail') {\n      return this.authorizeGmail();\n    } else if (this.settings.provider === 'outlook') {\n      return this.authorizeOutlook();\n    }\n    // IMAP doesn't need OAuth authorization\n    this.isAuthorized = true;\n    return true;\n  }\n  async authorizeGmail() {\n    // Gmail OAuth2 flow\n    try {\n      // Using Google APIs client library\n      const response = await window.gapi.load('auth2', () => {\n        window.gapi.auth2.init({\n          client_id: process.env.REACT_APP_GMAIL_CLIENT_ID,\n          scope: 'https://www.googleapis.com/auth/gmail.readonly'\n        });\n      });\n      const authInstance = window.gapi.auth2.getAuthInstance();\n      await authInstance.signIn();\n      this.isAuthorized = true;\n      return true;\n    } catch (error) {\n      console.error('Gmail authorization failed:', error);\n      return false;\n    }\n  }\n  async authorizeOutlook() {\n    // Microsoft Graph OAuth2 flow\n    try {\n      // Using MSAL.js\n      const response = await window.msal.loginPopup({\n        scopes: ['https://graph.microsoft.com/Mail.Read']\n      });\n      this.isAuthorized = true;\n      return true;\n    } catch (error) {\n      console.error('Outlook authorization failed:', error);\n      return false;\n    }\n  }\n  async fetchLatestEmails() {\n    if (!this.isAuthorized) {\n      throw new Error('Not authorized');\n    }\n    if (this.settings.provider === 'gmail') {\n      return this.fetchGmailEmails();\n    } else if (this.settings.provider === 'outlook') {\n      return this.fetchOutlookEmails();\n    }\n    return [];\n  }\n  async fetchGmailEmails() {\n    try {\n      const response = await window.gapi.client.gmail.users.messages.list({\n        userId: 'me',\n        q: `from:${this.settings.senderEmail}`,\n        maxResults: 5\n      });\n      const messages = response.result.messages || [];\n      const emailContents = [];\n      for (const message of messages) {\n        const details = await window.gapi.client.gmail.users.messages.get({\n          userId: 'me',\n          id: message.id\n        });\n        const content = this.extractEmailContent(details.result);\n        if (content) {\n          emailContents.push({\n            id: message.id,\n            date: new Date(parseInt(details.result.internalDate)),\n            content: content\n          });\n        }\n      }\n      return emailContents;\n    } catch (error) {\n      console.error('Failed to fetch Gmail emails:', error);\n      return [];\n    }\n  }\n  async fetchOutlookEmails() {\n    try {\n      const response = await fetch('https://graph.microsoft.com/v1.0/me/messages', {\n        headers: {\n          'Authorization': `Bearer ${window.msal.getAccount().accessToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      const data = await response.json();\n      const emails = data.value || [];\n      return emails.filter(email => email.sender.emailAddress.address === this.settings.senderEmail).slice(0, 5).map(email => ({\n        id: email.id,\n        date: new Date(email.receivedDateTime),\n        content: email.body.content\n      }));\n    } catch (error) {\n      console.error('Failed to fetch Outlook emails:', error);\n      return [];\n    }\n  }\n  extractEmailContent(message) {\n    // Extract text content from Gmail message\n    const parts = message.payload.parts || [message.payload];\n    for (const part of parts) {\n      if (part.mimeType === 'text/plain' && part.body.data) {\n        return atob(part.body.data.replace(/-/g, '+').replace(/_/g, '/'));\n      }\n    }\n    return null;\n  }\n\n  // Check if we need to load external scripts\n  static async loadRequiredScripts(provider) {\n    if (provider === 'gmail' && !window.gapi) {\n      return new Promise(resolve => {\n        const script = document.createElement('script');\n        script.src = 'https://apis.google.com/js/api.js';\n        script.onload = () => resolve();\n        document.head.appendChild(script);\n      });\n    }\n    if (provider === 'outlook' && !window.msal) {\n      return new Promise(resolve => {\n        const script = document.createElement('script');\n        script.src = 'https://alcdn.msauth.net/browser/2.14.2/js/msal-browser.min.js';\n        script.onload = () => resolve();\n        document.head.appendChild(script);\n      });\n    }\n  }\n}\nexport default EmailService;","map":{"version":3,"names":["EmailService","constructor","settings","isAuthorized","authorize","provider","authorizeGmail","authorizeOutlook","response","window","gapi","load","auth2","init","client_id","process","env","REACT_APP_GMAIL_CLIENT_ID","scope","authInstance","getAuthInstance","signIn","error","console","msal","loginPopup","scopes","fetchLatestEmails","Error","fetchGmailEmails","fetchOutlookEmails","client","gmail","users","messages","list","userId","q","senderEmail","maxResults","result","emailContents","message","details","get","id","content","extractEmailContent","push","date","Date","parseInt","internalDate","fetch","headers","getAccount","accessToken","data","json","emails","value","filter","email","sender","emailAddress","address","slice","map","receivedDateTime","body","parts","payload","part","mimeType","atob","replace","loadRequiredScripts","Promise","resolve","script","document","createElement","src","onload","head","appendChild"],"sources":["/home/chakri/Documents/Projects/Website/src/utils/emailService.js"],"sourcesContent":["// Email integration service\n// Supports Gmail API, Outlook Graph API, and generic IMAP\n\nclass EmailService {\n  constructor(settings) {\n    this.settings = settings;\n    this.isAuthorized = false;\n  }\n\n  async authorize() {\n    if (this.settings.provider === 'gmail') {\n      return this.authorizeGmail();\n    } else if (this.settings.provider === 'outlook') {\n      return this.authorizeOutlook();\n    }\n    // IMAP doesn't need OAuth authorization\n    this.isAuthorized = true;\n    return true;\n  }\n\n  async authorizeGmail() {\n    // Gmail OAuth2 flow\n    try {\n      // Using Google APIs client library\n      const response = await window.gapi.load('auth2', () => {\n        window.gapi.auth2.init({\n          client_id: process.env.REACT_APP_GMAIL_CLIENT_ID,\n          scope: 'https://www.googleapis.com/auth/gmail.readonly'\n        });\n      });\n      \n      const authInstance = window.gapi.auth2.getAuthInstance();\n      await authInstance.signIn();\n      this.isAuthorized = true;\n      return true;\n    } catch (error) {\n      console.error('Gmail authorization failed:', error);\n      return false;\n    }\n  }\n\n  async authorizeOutlook() {\n    // Microsoft Graph OAuth2 flow\n    try {\n      // Using MSAL.js\n      const response = await window.msal.loginPopup({\n        scopes: ['https://graph.microsoft.com/Mail.Read']\n      });\n      this.isAuthorized = true;\n      return true;\n    } catch (error) {\n      console.error('Outlook authorization failed:', error);\n      return false;\n    }\n  }\n\n  async fetchLatestEmails() {\n    if (!this.isAuthorized) {\n      throw new Error('Not authorized');\n    }\n\n    if (this.settings.provider === 'gmail') {\n      return this.fetchGmailEmails();\n    } else if (this.settings.provider === 'outlook') {\n      return this.fetchOutlookEmails();\n    }\n    \n    return [];\n  }\n\n  async fetchGmailEmails() {\n    try {\n      const response = await window.gapi.client.gmail.users.messages.list({\n        userId: 'me',\n        q: `from:${this.settings.senderEmail}`,\n        maxResults: 5\n      });\n\n      const messages = response.result.messages || [];\n      const emailContents = [];\n\n      for (const message of messages) {\n        const details = await window.gapi.client.gmail.users.messages.get({\n          userId: 'me',\n          id: message.id\n        });\n\n        const content = this.extractEmailContent(details.result);\n        if (content) {\n          emailContents.push({\n            id: message.id,\n            date: new Date(parseInt(details.result.internalDate)),\n            content: content\n          });\n        }\n      }\n\n      return emailContents;\n    } catch (error) {\n      console.error('Failed to fetch Gmail emails:', error);\n      return [];\n    }\n  }\n\n  async fetchOutlookEmails() {\n    try {\n      const response = await fetch('https://graph.microsoft.com/v1.0/me/messages', {\n        headers: {\n          'Authorization': `Bearer ${window.msal.getAccount().accessToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const data = await response.json();\n      const emails = data.value || [];\n\n      return emails\n        .filter(email => email.sender.emailAddress.address === this.settings.senderEmail)\n        .slice(0, 5)\n        .map(email => ({\n          id: email.id,\n          date: new Date(email.receivedDateTime),\n          content: email.body.content\n        }));\n    } catch (error) {\n      console.error('Failed to fetch Outlook emails:', error);\n      return [];\n    }\n  }\n\n  extractEmailContent(message) {\n    // Extract text content from Gmail message\n    const parts = message.payload.parts || [message.payload];\n    \n    for (const part of parts) {\n      if (part.mimeType === 'text/plain' && part.body.data) {\n        return atob(part.body.data.replace(/-/g, '+').replace(/_/g, '/'));\n      }\n    }\n    \n    return null;\n  }\n\n  // Check if we need to load external scripts\n  static async loadRequiredScripts(provider) {\n    if (provider === 'gmail' && !window.gapi) {\n      return new Promise((resolve) => {\n        const script = document.createElement('script');\n        script.src = 'https://apis.google.com/js/api.js';\n        script.onload = () => resolve();\n        document.head.appendChild(script);\n      });\n    }\n    \n    if (provider === 'outlook' && !window.msal) {\n      return new Promise((resolve) => {\n        const script = document.createElement('script');\n        script.src = 'https://alcdn.msauth.net/browser/2.14.2/js/msal-browser.min.js';\n        script.onload = () => resolve();\n        document.head.appendChild(script);\n      });\n    }\n  }\n}\n\nexport default EmailService;\n"],"mappings":"AAAA;AACA;;AAEA,MAAMA,YAAY,CAAC;EACjBC,WAAWA,CAACC,QAAQ,EAAE;IACpB,IAAI,CAACA,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACC,YAAY,GAAG,KAAK;EAC3B;EAEA,MAAMC,SAASA,CAAA,EAAG;IAChB,IAAI,IAAI,CAACF,QAAQ,CAACG,QAAQ,KAAK,OAAO,EAAE;MACtC,OAAO,IAAI,CAACC,cAAc,CAAC,CAAC;IAC9B,CAAC,MAAM,IAAI,IAAI,CAACJ,QAAQ,CAACG,QAAQ,KAAK,SAAS,EAAE;MAC/C,OAAO,IAAI,CAACE,gBAAgB,CAAC,CAAC;IAChC;IACA;IACA,IAAI,CAACJ,YAAY,GAAG,IAAI;IACxB,OAAO,IAAI;EACb;EAEA,MAAMG,cAAcA,CAAA,EAAG;IACrB;IACA,IAAI;MACF;MACA,MAAME,QAAQ,GAAG,MAAMC,MAAM,CAACC,IAAI,CAACC,IAAI,CAAC,OAAO,EAAE,MAAM;QACrDF,MAAM,CAACC,IAAI,CAACE,KAAK,CAACC,IAAI,CAAC;UACrBC,SAAS,EAAEC,OAAO,CAACC,GAAG,CAACC,yBAAyB;UAChDC,KAAK,EAAE;QACT,CAAC,CAAC;MACJ,CAAC,CAAC;MAEF,MAAMC,YAAY,GAAGV,MAAM,CAACC,IAAI,CAACE,KAAK,CAACQ,eAAe,CAAC,CAAC;MACxD,MAAMD,YAAY,CAACE,MAAM,CAAC,CAAC;MAC3B,IAAI,CAAClB,YAAY,GAAG,IAAI;MACxB,OAAO,IAAI;IACb,CAAC,CAAC,OAAOmB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,OAAO,KAAK;IACd;EACF;EAEA,MAAMf,gBAAgBA,CAAA,EAAG;IACvB;IACA,IAAI;MACF;MACA,MAAMC,QAAQ,GAAG,MAAMC,MAAM,CAACe,IAAI,CAACC,UAAU,CAAC;QAC5CC,MAAM,EAAE,CAAC,uCAAuC;MAClD,CAAC,CAAC;MACF,IAAI,CAACvB,YAAY,GAAG,IAAI;MACxB,OAAO,IAAI;IACb,CAAC,CAAC,OAAOmB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACrD,OAAO,KAAK;IACd;EACF;EAEA,MAAMK,iBAAiBA,CAAA,EAAG;IACxB,IAAI,CAAC,IAAI,CAACxB,YAAY,EAAE;MACtB,MAAM,IAAIyB,KAAK,CAAC,gBAAgB,CAAC;IACnC;IAEA,IAAI,IAAI,CAAC1B,QAAQ,CAACG,QAAQ,KAAK,OAAO,EAAE;MACtC,OAAO,IAAI,CAACwB,gBAAgB,CAAC,CAAC;IAChC,CAAC,MAAM,IAAI,IAAI,CAAC3B,QAAQ,CAACG,QAAQ,KAAK,SAAS,EAAE;MAC/C,OAAO,IAAI,CAACyB,kBAAkB,CAAC,CAAC;IAClC;IAEA,OAAO,EAAE;EACX;EAEA,MAAMD,gBAAgBA,CAAA,EAAG;IACvB,IAAI;MACF,MAAMrB,QAAQ,GAAG,MAAMC,MAAM,CAACC,IAAI,CAACqB,MAAM,CAACC,KAAK,CAACC,KAAK,CAACC,QAAQ,CAACC,IAAI,CAAC;QAClEC,MAAM,EAAE,IAAI;QACZC,CAAC,EAAE,QAAQ,IAAI,CAACnC,QAAQ,CAACoC,WAAW,EAAE;QACtCC,UAAU,EAAE;MACd,CAAC,CAAC;MAEF,MAAML,QAAQ,GAAG1B,QAAQ,CAACgC,MAAM,CAACN,QAAQ,IAAI,EAAE;MAC/C,MAAMO,aAAa,GAAG,EAAE;MAExB,KAAK,MAAMC,OAAO,IAAIR,QAAQ,EAAE;QAC9B,MAAMS,OAAO,GAAG,MAAMlC,MAAM,CAACC,IAAI,CAACqB,MAAM,CAACC,KAAK,CAACC,KAAK,CAACC,QAAQ,CAACU,GAAG,CAAC;UAChER,MAAM,EAAE,IAAI;UACZS,EAAE,EAAEH,OAAO,CAACG;QACd,CAAC,CAAC;QAEF,MAAMC,OAAO,GAAG,IAAI,CAACC,mBAAmB,CAACJ,OAAO,CAACH,MAAM,CAAC;QACxD,IAAIM,OAAO,EAAE;UACXL,aAAa,CAACO,IAAI,CAAC;YACjBH,EAAE,EAAEH,OAAO,CAACG,EAAE;YACdI,IAAI,EAAE,IAAIC,IAAI,CAACC,QAAQ,CAACR,OAAO,CAACH,MAAM,CAACY,YAAY,CAAC,CAAC;YACrDN,OAAO,EAAEA;UACX,CAAC,CAAC;QACJ;MACF;MAEA,OAAOL,aAAa;IACtB,CAAC,CAAC,OAAOnB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACrD,OAAO,EAAE;IACX;EACF;EAEA,MAAMQ,kBAAkBA,CAAA,EAAG;IACzB,IAAI;MACF,MAAMtB,QAAQ,GAAG,MAAM6C,KAAK,CAAC,8CAA8C,EAAE;QAC3EC,OAAO,EAAE;UACP,eAAe,EAAE,UAAU7C,MAAM,CAACe,IAAI,CAAC+B,UAAU,CAAC,CAAC,CAACC,WAAW,EAAE;UACjE,cAAc,EAAE;QAClB;MACF,CAAC,CAAC;MAEF,MAAMC,IAAI,GAAG,MAAMjD,QAAQ,CAACkD,IAAI,CAAC,CAAC;MAClC,MAAMC,MAAM,GAAGF,IAAI,CAACG,KAAK,IAAI,EAAE;MAE/B,OAAOD,MAAM,CACVE,MAAM,CAACC,KAAK,IAAIA,KAAK,CAACC,MAAM,CAACC,YAAY,CAACC,OAAO,KAAK,IAAI,CAAC/D,QAAQ,CAACoC,WAAW,CAAC,CAChF4B,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CACXC,GAAG,CAACL,KAAK,KAAK;QACbjB,EAAE,EAAEiB,KAAK,CAACjB,EAAE;QACZI,IAAI,EAAE,IAAIC,IAAI,CAACY,KAAK,CAACM,gBAAgB,CAAC;QACtCtB,OAAO,EAAEgB,KAAK,CAACO,IAAI,CAACvB;MACtB,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,OAAOxB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,OAAO,EAAE;IACX;EACF;EAEAyB,mBAAmBA,CAACL,OAAO,EAAE;IAC3B;IACA,MAAM4B,KAAK,GAAG5B,OAAO,CAAC6B,OAAO,CAACD,KAAK,IAAI,CAAC5B,OAAO,CAAC6B,OAAO,CAAC;IAExD,KAAK,MAAMC,IAAI,IAAIF,KAAK,EAAE;MACxB,IAAIE,IAAI,CAACC,QAAQ,KAAK,YAAY,IAAID,IAAI,CAACH,IAAI,CAACZ,IAAI,EAAE;QACpD,OAAOiB,IAAI,CAACF,IAAI,CAACH,IAAI,CAACZ,IAAI,CAACkB,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;MACnE;IACF;IAEA,OAAO,IAAI;EACb;;EAEA;EACA,aAAaC,mBAAmBA,CAACvE,QAAQ,EAAE;IACzC,IAAIA,QAAQ,KAAK,OAAO,IAAI,CAACI,MAAM,CAACC,IAAI,EAAE;MACxC,OAAO,IAAImE,OAAO,CAAEC,OAAO,IAAK;QAC9B,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;QAC/CF,MAAM,CAACG,GAAG,GAAG,mCAAmC;QAChDH,MAAM,CAACI,MAAM,GAAG,MAAML,OAAO,CAAC,CAAC;QAC/BE,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,MAAM,CAAC;MACnC,CAAC,CAAC;IACJ;IAEA,IAAI1E,QAAQ,KAAK,SAAS,IAAI,CAACI,MAAM,CAACe,IAAI,EAAE;MAC1C,OAAO,IAAIqD,OAAO,CAAEC,OAAO,IAAK;QAC9B,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;QAC/CF,MAAM,CAACG,GAAG,GAAG,gEAAgE;QAC7EH,MAAM,CAACI,MAAM,GAAG,MAAML,OAAO,CAAC,CAAC;QAC/BE,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,MAAM,CAAC;MACnC,CAAC,CAAC;IACJ;EACF;AACF;AAEA,eAAe/E,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}